#!/bin/bash

echo "Running sudo apt update..."
sudo apt update

echo -e "\nRunning sudo apt upgrade..."
sudo apt upgrade

# install CURL if you don't have it
echo -e "\nInstalling CURL..."
sudo apt install curl

# define the download URL for Nessus
URL="https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-10.5.3-ubuntu1404_amd64.deb"

# define the output directory
nessus_directory="/home/Kali/tools/nessus"

echo -e "\nCreating directory to store the download..."

# check if the directory exists
if [ ! -d "$nessus_directory" ]; then
    # create the new directory
    sudo mkdir -p "$nessus_directory"
    sudo chmod 777 $nessus_directory
    echo "The directory $nessus_directory was created successfully."
else
    echo "The directory $nessus_directory already exists."
fi

# define the expected output path of the file to download
output_path="/home/Kali/tools/nessus/Nessus-10.5.3-ubuntu1404_amd64.deb"

echo -e "\nDownloading and Installing Nessus packages..."

# check if the file was downloaded
if [ ! -e "$output_path" ]; then
    # download the nessus package to the new directory using CURL
    echo -e "\nDownloading Nessus..."
    curl -O $URL --output-dir $nessus_directory

    # install the package
    echo -e "\nInstalling Nessus..."
    sudo dpkg -i $output_path
else
    echo "Nessus has already been downloaded and installed."
fi

# restart the nessusd daemon
echo -e "\nRestarting nessusd daemon..."
sudo systemctl start nessusd

# open nessus in firefox
echo -e "\nOpening Nessus in Firefox..."
firefox https://localhost:8834
